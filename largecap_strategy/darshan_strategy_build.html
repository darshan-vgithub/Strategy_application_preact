<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Flameback || Strategy</title>
    <link rel="icon" href="./assets/logo-favicon.ico" type="image/x-icon" />
  </head>
  <body>
    <script type="module">
      import { html, render, useState } from "https://esm.sh/htm/preact/standalone";
      import { Form } from "./form.js";
      import strategies from "./strategies.json" with { type: "json" };

      function App() {
        const [strategyName, setStrategyName] = useState("");
        const [strategyData, setStrategyData] = useState({
          class: "",
          filters: [],
          universe: ""
        });

        const handleStrategyNameChange = (e) => {
          const name = e.target.value.trim(); // Trim to avoid unwanted spaces
          setStrategyName(name);

          console.log("Entered Strategy Name:", name);

          // Check if the strategy exists in the data
          if (strategies[name]) {
            console.log("Found Strategy:", strategies[name]);

            setStrategyData({
              class: strategies[name].class || "", // Use default empty string if not found
              filters: strategies[name].filters || [], // Default to an empty array
              universe: strategies[name].universe || ""
            });
          } else {
            console.log("Strategy not found in JSON");
            // Clear data if strategy not found
            setStrategyData({ class: "", filters: [], universe: "" });
          }
        };

        return html`
          <${Form}
            strategy=${strategyName}
            class_name=${strategyData.class || ""}
            universe=${strategyData.universe || ""}
            filters=${strategyData.filters || []}
            onStrategyNameChange=${handleStrategyNameChange}
          />
        `;
      }

      render(html`<${App} />`, document.body);
    </script>
  </body>
</html>
