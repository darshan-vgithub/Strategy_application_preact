<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Flameback || Strategy</title>
    <link rel="icon" href="./assets/logo-favicon.ico" type="image/x-icon" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
  </head>
  <body>
    <script type="module">
      import {
        html,
        render,
        useState,
      } from "https://esm.sh/htm/preact/standalone";
      import { Form } from "./form.js";
      import { FilterForm } from "./FilterForm.js";
      import { Toast } from "./Toast.js"; // Import the Toast component
      import strategies from "./strategies.json" with { type: "json" };

      function App() {
        const [strategyData, setStrategyData] = useState({
          label: "",
          universe: "",
          class: "",
          filters: [],
        });

        const [toastMessage, setToastMessage] = useState("");
        const [toastType, setToastType] = useState("success"); // 'success' or 'error'

        const handleChange = (ev) => {
          const val = ev.target.value;
          let prop = ev.target.dataset['prop']
          if ('label' === prop && strategies.hasOwnProperty(val)) {
            const strategy = strategies[val];
            setStrategyData({
              label: val,
              class: strategy.class || "",
              filters: strategy.filters || [],
              universe: strategy.universe || "",
            });
          } else {
            const newState = {};
            if( prop === 'class_name')
              prop = 'class'
            newState[prop] = val;
            setStrategyData({
              ...strategyData, ...newState
            });
          }
        };

        return html`
          <${Form}
            label=${strategyData.label}
            class_name=${strategyData.class || ""}
            universe=${strategyData.universe || ""}
            filters=${strategyData.filters || []}
            onStateChange=${handleChange}
          />
        `;
      }

      render(html`<${App} />`, document.body);
    </script>
  </body>
</html>
