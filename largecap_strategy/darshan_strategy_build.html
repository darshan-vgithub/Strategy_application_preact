<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Flameback || Strategy</title>
    <link rel="icon" href="./assets/logo-favicon.ico" type="image/x-icon" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
  </head>
  <body>
    <script type="module">
      import {
        html,
        render,
        useState,
      } from "https://esm.sh/htm/preact/standalone";
      import { Form } from "./form.js";
      import { FilterForm } from "./FilterForm.js";
      import { Toast } from "./Toast.js"; // Import the Toast component
      import { CustomFilterForm } from "./CustomFilterForm.js"; // Import CustomFilterForm

      const strategies = {
        "Example Strategy": {
          class: "ExampleClass",
          filters: [],
          universe: "ExampleUniverse",
        },
      };

      function App() {
        const [strategyName, setStrategyName] = useState("");
        const [strategyData, setStrategyData] = useState({
          class: "",
          filters: [],
          universe: "",
        });
        const [availableFilters, setAvailableFilters] = useState([]);
        const [filterForms, setFilterForms] = useState([]);
        const [toastMessage, setToastMessage] = useState("");
        const [toastType, setToastType] = useState("success"); // 'success' or 'error'
        const [customFilters, setCustomFilters] = useState([]); // Track custom filters

        const handleStrategyNameChange = (e) => {
          const name = e.target.value.trim();
          setStrategyName(name);

          if (strategies[name]) {
            setStrategyData({
              class: strategies[name].class || "",
              filters: strategies[name].filters || [],
              universe: strategies[name].universe || "",
            });
            setAvailableFilters(strategies[name].filters || []);
          } else {
            setStrategyData({ class: "", filters: [], universe: "" });
            setAvailableFilters([]);
          }
        };

        const handleDeleteFilter = (id) => {
          setFilterForms((prevForms) =>
            prevForms.filter((form) => form.id !== id)
          );
          setToastMessage("Filter deleted successfully!");
          setToastType("error");
          setTimeout(() => setToastMessage(""), 3000); // Hide toast after 3 seconds
        };

        return html`
          <${Form}
            strategy=${strategyName}
            class_name=${strategyData.class || ""}
            universe=${strategyData.universe || ""}
            filters=${strategyData.filters || []}
            onStrategyNameChange=${handleStrategyNameChange}
          />
          <!-- Toast Notifications -->
          <${Toast} message=${toastMessage} type=${toastType} />
        `;
      }

      render(html`<${App} />`, document.body);
    </script>
  </body>
</html>
